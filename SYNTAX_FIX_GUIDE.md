# Jenkinsfile è¯­æ³•é”™è¯¯ä¿®å¤æŒ‡å—

## ðŸ› é—®é¢˜æè¿°

### é”™è¯¯ä¿¡æ¯
```
org.codehaus.groovy.control.MultipleCompilationErrorsException: startup failed:
WorkflowScript: 220: unexpected char: '\' @ line 220, column 17.
location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)\$ {
```

### é—®é¢˜åˆ†æž

è¿™æ˜¯ä¸€ä¸ªGroovyè¯­æ³•é”™è¯¯ï¼Œåœ¨Jenkins Pipelineä¸­ï¼Œå½“ä½¿ç”¨`sh`å‘½ä»¤çš„å¤šè¡Œå­—ç¬¦ä¸²ï¼ˆheredocï¼‰æ—¶ï¼Œåæ–œæ è½¬ä¹‰å­—ç¬¦éœ€è¦ç‰¹æ®Šå¤„ç†ã€‚

## ðŸ”§ ä¿®å¤å†…å®¹

### 1. Nginxé…ç½®ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼è½¬ä¹‰

**é—®é¢˜ä»£ç **ï¼š
```groovy
location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)\$ {
```

**ä¿®å¤åŽ**ï¼š
```groovy
location ~* \\.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)\\$ {
```

**ä¿®å¤è¯´æ˜Ž**ï¼š
- åœ¨Groovyçš„å¤šè¡Œå­—ç¬¦ä¸²ä¸­ï¼Œåæ–œæ éœ€è¦åŒé‡è½¬ä¹‰
- `\.` éœ€è¦æ”¹ä¸º `\\.`
- `\$` éœ€è¦æ”¹ä¸º `\\$`

### 2. try_filesæŒ‡ä»¤è½¬ä¹‰

**é—®é¢˜ä»£ç **ï¼š
```groovy
try_files \$uri \$uri/ /index.html;
```

**ä¿®å¤åŽ**ï¼š
```groovy
try_files \\$uri \\$uri/ /index.html;
```

### 3. Content-Security-Policyç®€åŒ–

**åŽŸæ¥çš„å¤æ‚å¼•å·åµŒå¥—**ï¼š
```groovy
add_header Content-Security-Policy "default-src '"'"'self'"'"' http: https: data: blob: '"'"'unsafe-inline'"'"'" always;
```

**ç®€åŒ–åŽ**ï¼š
```groovy
add_header Content-Security-Policy "default-src 'self' http: https: data: blob: 'unsafe-inline'" always;
```

### 4. Node.jsç‰ˆæœ¬é…ç½®ä¿®å¤

**æ ¹æ®å†…å­˜çŸ¥è¯†è¦æ±‚**ï¼š
```groovy
// ä¿®å¤å‰
tools {
    nodejs "NodeJS 22"
}

// ä¿®å¤åŽ - ä½¿ç”¨Node.js 20.xç‰ˆæœ¬
tools {
    nodejs "NodeJS 20"
}
```

## ðŸ“‹ Groovyå­—ç¬¦ä¸²è½¬ä¹‰è§„åˆ™

### åœ¨Jenkins Pipelineä¸­çš„å­—ç¬¦ä¸²å¤„ç†

#### 1. å•è¡Œå­—ç¬¦ä¸²
```groovy
sh 'echo "Hello World"'  // ç®€å•å­—ç¬¦ä¸²ï¼Œæ— éœ€ç‰¹æ®Šè½¬ä¹‰
```

#### 2. å¤šè¡Œå­—ç¬¦ä¸²ï¼ˆtriple-quotedï¼‰
```groovy
sh '''
    echo "Hello"
    echo "World"
'''  // ä¿æŒåŽŸæ ·ï¼Œä½†è¦æ³¨æ„å˜é‡æ’å€¼
```

#### 3. å¤šè¡Œå­—ç¬¦ä¸²ä¸Žå˜é‡æ’å€¼
```groovy
sh """
    echo "Hello ${VARIABLE}"
    # ç‰¹æ®Šå­—ç¬¦éœ€è¦è½¬ä¹‰
    echo "Dollar sign: \\$"
    echo "Backslash: \\\\"
"""
```

#### 4. Hereæ–‡æ¡£ï¼ˆHeredocï¼‰
```groovy
sh """
    cat > file.conf << 'EOF'
    # åœ¨heredocä¸­ï¼Œç‰¹æ®Šå­—ç¬¦éœ€è¦æ ¹æ®ä¸Šä¸‹æ–‡è½¬ä¹‰
    location ~* \\\\.(js|css)\\\\$ {
        # åŒé‡è½¬ä¹‰ï¼šGroovy -> Shell -> Nginx
    }
EOF
"""
```

## ðŸ› ï¸ è½¬ä¹‰å­—ç¬¦å¯¹ç…§è¡¨

| ç›®æ ‡å­—ç¬¦ | Groovyå­—ç¬¦ä¸²ä¸­ | Shellè„šæœ¬ä¸­ | æœ€ç»ˆæ•ˆæžœ |
|----------|----------------|-------------|----------|
| `$` | `\\$` | `\$` | `$` |
| `\` | `\\\\` | `\\` | `\` |
| `"` | `\\"` | `\"` | `"` |
| `'` | `'` | `\'` | `'` |

## ðŸ” å¸¸è§é”™è¯¯æ¨¡å¼

### 1. æ­£åˆ™è¡¨è¾¾å¼é”™è¯¯
```groovy
// âŒ é”™è¯¯
location ~* \.(js|css)\$ {

// âœ… æ­£ç¡®
location ~* \\.(js|css)\\$ {
```

### 2. å˜é‡å¼•ç”¨é”™è¯¯
```groovy
// âŒ é”™è¯¯
echo "Value: \$VARIABLE"

// âœ… æ­£ç¡®
echo "Value: \\$VARIABLE"
```

### 3. è·¯å¾„åˆ†éš”ç¬¦é”™è¯¯
```groovy
// âŒ é”™è¯¯ï¼ˆWindowsè·¯å¾„ï¼‰
path = "C:\Users\test"

// âœ… æ­£ç¡®
path = "C:\\\\Users\\\\test"
```

## ðŸ§ª æµ‹è¯•å’ŒéªŒè¯

### 1. è¯­æ³•æ£€æŸ¥
```bash
# æœ¬åœ°æµ‹è¯•Groovyè¯­æ³•
groovy -e "println '''your_multiline_string'''"
```

### 2. Nginxé…ç½®éªŒè¯
```bash
# åœ¨æœåŠ¡å™¨ä¸Šæµ‹è¯•Nginxé…ç½®
nginx -t
```

### 3. æ­£åˆ™è¡¨è¾¾å¼æµ‹è¯•
```bash
# æµ‹è¯•æ­£åˆ™è¡¨è¾¾å¼
echo "test.js" | grep -E '\.(js|css)$'
```

## ðŸŽ¯ æœ€ä½³å®žè·µ

### 1. ä½¿ç”¨é€‚å½“çš„å¼•å·ç±»åž‹
- **å•å¼•å·**: å­—é¢å­—ç¬¦ä¸²ï¼Œæ— å˜é‡æ’å€¼
- **åŒå¼•å·**: æ”¯æŒå˜é‡æ’å€¼
- **ä¸‰é‡å¼•å·**: å¤šè¡Œå­—ç¬¦ä¸²

### 2. åˆ†å±‚è½¬ä¹‰ç­–ç•¥
```groovy
// æ˜Žç¡®æ¯ä¸€å±‚çš„è½¬ä¹‰éœ€æ±‚
sh """
    # Groovyå±‚: åŒå¼•å·å­—ç¬¦ä¸²ï¼Œæ”¯æŒå˜é‡æ’å€¼
    # Shellå±‚: éœ€è¦è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦
    # åº”ç”¨å±‚: æœ€ç»ˆé…ç½®æ–‡ä»¶çš„è¯­æ³•è¦æ±‚
    
    cat > nginx.conf << 'EOF'
    location ~* \\.(js|css)\\$ {
        # è¿™é‡Œæ˜¯æœ€ç»ˆçš„Nginxé…ç½®
    }
EOF
"""
```

### 3. é…ç½®æ–‡ä»¶å¤–éƒ¨åŒ–
```groovy
// å¤æ‚é…ç½®å»ºè®®å¤–éƒ¨åŒ–
sh """
    # ä»Žå¤–éƒ¨æ–‡ä»¶å¤åˆ¶é…ç½®
    cp /path/to/nginx.conf.template ./nginx.conf
    
    # ä½¿ç”¨sedæ›¿æ¢å˜é‡
    sed -i 's/{{SERVER_NAME}}/${SERVER_NAME}/g' ./nginx.conf
"""
```

## ðŸ“ž æ•…éšœæŽ’é™¤

### 1. è¯­æ³•é”™è¯¯å®šä½
- æŸ¥çœ‹JenkinsæŽ§åˆ¶å°çš„è¯¦ç»†é”™è¯¯ä¿¡æ¯
- æ³¨æ„è¡Œå·å’Œåˆ—å·ä¿¡æ¯
- é€è¡Œæ£€æŸ¥è½¬ä¹‰å­—ç¬¦

### 2. é…ç½®éªŒè¯
- ä½¿ç”¨`echo`å‘½ä»¤è¾“å‡ºç”Ÿæˆçš„é…ç½®
- åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šæ‰‹åŠ¨éªŒè¯é…ç½®è¯­æ³•
- ä½¿ç”¨`set -x`å¼€å¯Shellè°ƒè¯•æ¨¡å¼

### 3. å¢žé‡ä¿®å¤
- å…ˆæ³¨é‡ŠæŽ‰å¤æ‚éƒ¨åˆ†ï¼Œç¡®ä¿åŸºæœ¬åŠŸèƒ½å·¥ä½œ
- é€æ­¥å–æ¶ˆæ³¨é‡Šï¼Œå®šä½å…·ä½“é—®é¢˜
- ä½¿ç”¨ç®€åŒ–ç‰ˆæœ¬éªŒè¯ä¿®å¤æ•ˆæžœ

## âœ… ä¿®å¤éªŒè¯

ä¿®å¤å®ŒæˆåŽï¼ŒJenkinsfileåº”è¯¥èƒ½å¤Ÿï¼š
1. âœ… é€šè¿‡Groovyè¯­æ³•æ£€æŸ¥
2. âœ… æˆåŠŸç”ŸæˆNginxé…ç½®æ–‡ä»¶
3. âœ… æ­£ç¡®å¤„ç†React Routerè·¯ç”±
4. âœ… æ­£ç¡®é…ç½®é™æ€èµ„æºç¼“å­˜
5. âœ… å®¹å™¨å¯åŠ¨å’Œè¿è¡Œæ­£å¸¸

çŽ°åœ¨é‡æ–°è¿è¡ŒJenkins Pipelineåº”è¯¥ä¸ä¼šå†å‡ºçŽ°è¯­æ³•é”™è¯¯ï¼